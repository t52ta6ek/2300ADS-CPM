; *****
; ***** SYSTEM RE-INITIALIZER
; ***** TOM DE LELLIS
; ***** 11/29/85
; *****
;
	.Z80
	CSEG
;
	PUBLIC	INIT
	PUBLIC	REINIT
;
	EXTRN	SIOTABS
	EXTRN	GRFLAG
	EXTRN	NCSRFLG
	EXTRN	IOBSTO
	EXTRN	XRDY
	EXTRN	MPIOBST
;
SIO1MOD	EQU	X'C2'			; SIO1 MODE PORT
SIO1CMD	EQU	X'C3'			; SIO1 COMMAND PORT
;
SIO2MOD	EQU	X'C6'			; SIO2 MODE PORT
SIO2CMD	EQU	X'C7'			; SIO2 COMMAND PORT
;
SIO3MOD	EQU	X'A2'			; SIO3 MODE PORT
SIO3CMD	EQU	X'A3'			; SIO3 COMMAND PORT
;
SIO4MOD	EQU	X'A6'			; SIO4 MODE PORT
SIO4CMD	EQU	X'A7'			; SIO4 COMMAND PORT
;
BCPORT	EQU	X'CC'			; BOARD COMMAND PORT
DRESET	EQU	X'CE'			; DRIVE RESET PORT
;
INIT:
	LD	A,(IOBSTO)		; GET DEFAULT I/O BYTE
	LD	(3),A			; RESET SYSTEM I/O BYTE
;
REINIT:
	LD	A,(MPIOBST)		; GET DEFAULT MPIO BOARD STATUS
	OUT	(BCPORT),A		; OUTPUT TO MPIO
	OUT	(DRESET),A		; RESET DISK CONTROLLER
;
	LD	HL,SIOTABS		; PTR TO SIO TABLE
	LD	A,(HL)			; COMMAND
	OUT	(SIO1CMD),A		; SEND IT
	INC	HL			; NEXT
	LD	A,(HL)			; GET PROTOCOL FOR PORT 1
	OUT	(SIO1MOD),A		; SEND IT
	INC	HL			; NEXT
	LD	A,(HL)			; GET BAUD FOR PORT 1
	OUT	(SIO1MOD),A		; SEND IT
;
	INC	HL			; NEXT
	LD	A,(HL)			; COMMAND
	OUT	(SIO2CMD),A		; SEND IT
	INC	HL			; NEXT
	LD	A,(HL)			; GET PROTOCOL FOR PORT 2
	OUT	(SIO2MOD),A		; SEND IT
	INC	HL			; NEXT
	LD	A,(HL)			; GET BAUD FOR PORT 2
	OUT	(SIO2MOD),A		; SEND IT
;
	INC	HL			; NEXT
	LD	A,(HL)			; COMMAND
	OUT	(SIO3CMD),A		; SEND IT
	INC	HL			; NEXT
	LD	A,(HL)			; GET PROTOCOL FOR PORT 3
	OUT	(SIO3MOD),A		; SEND IT
	INC	HL			; NEXT
	LD	A,(HL)			; GET BAUD FOR PORT 3
	OUT	(SIO3MOD),A		; SEND IT
;
	INC	HL			; NEXT
	LD	A,(HL)			; COMMAND
	OUT	(SIO4CMD),A		; SEND IT
	INC	HL			; NEXT
	LD	A,(HL)			; GET PROTOCOL FOR PORT 4
	OUT	(SIO4MOD),A		; SEND IT
	INC	HL			; NEXT
	LD	A,(HL)			; GET BAUD FOR PORT 4
	OUT	(SIO4MOD),A		; SEND IT
;
	XOR	A			; LOAD A FALSE
	LD	(GRFLAG),A		; NO GRAPHICS
	LD	(NCSRFLG),A		; NO NOT-CURSOR
	CPL				; NOT 0
	LD	(XRDY),A		; RESET XOFF/XON TO READY STATE
;
	RET				; EXIT
;
	END
